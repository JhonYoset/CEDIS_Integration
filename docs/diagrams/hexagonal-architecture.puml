@startuml CEDIS_Hexagonal_Architecture
!theme plain

title Sistema CEDIS - Arquitectura Hexagonal (Backend)
subtitle Clean Architecture implementada en NestJS

package "üåê Adaptadores Primarios (Driving)" {
    [üéÆ Controllers] as controllers
    [üîê Auth Guards] as guards
    [üì° HTTP Interceptors] as interceptors
}

package "üèõÔ∏è N√∫cleo de Aplicaci√≥n (Core)" {
    package "üìã Casos de Uso (Application)" {
        [üë§ Usuario Service] as userService
        [üìñ Lector Service] as lectorService
        [üìÑ Documento Service] as docService
        [üè∑Ô∏è Categor√≠a Service] as catService
        [üìã Pr√©stamo Service] as prestamoService
    }
    
    package "üèóÔ∏è Dominio (Domain)" {
        [üë§ Usuario Entity] as userEntity
        [üìñ Lector Entity] as lectorEntity
        [üìÑ Documento Entity] as docEntity
        [üè∑Ô∏è Categor√≠a Entity] as catEntity
        [üìã Pr√©stamo Entity] as prestamoEntity
    }
    
    package "üîå Contratos (Ports)" {
        [üë§ Usuario Repository] as userPort
        [üìñ Lector Repository] as lectorPort
        [üìÑ Documento Repository] as docPort
        [üè∑Ô∏è Categor√≠a Repository] as catPort
        [üìã Pr√©stamo Repository] as prestamoPort
    }
}

package "üîß Adaptadores Secundarios (Driven)" {
    [üóÑÔ∏è TypeORM Repositories] as repositories
    [üêò PostgreSQL Database] as database
    [üîë JWT Strategy] as jwtStrategy
    [üåê Google OAuth Strategy] as googleStrategy
}

' Relaciones Adaptadores Primarios
controllers --> userService
controllers --> lectorService
controllers --> docService
controllers --> catService
controllers --> prestamoService

guards --> jwtStrategy
interceptors --> jwtStrategy

' Relaciones Core
userService --> userEntity
userService --> userPort

lectorService --> lectorEntity
lectorService --> lectorPort

docService --> docEntity
docService --> docPort

catService --> catEntity
catService --> catPort

prestamoService --> prestamoEntity
prestamoService --> prestamoPort

' Relaciones Adaptadores Secundarios
userPort <|-- repositories
lectorPort <|-- repositories
docPort <|-- repositories
catPort <|-- repositories
prestamoPort <|-- repositories

repositories --> database
jwtStrategy --> database
googleStrategy --> database

note top of controllers
  <b>Controladores REST:</b>
  ‚Ä¢ UsuarioController
  ‚Ä¢ LectorController
  ‚Ä¢ DocumentoController
  ‚Ä¢ CategoriaController
  ‚Ä¢ PrestamoController
  ‚Ä¢ AuthController
end note

note bottom of database
  <b>Base de Datos:</b>
  ‚Ä¢ PostgreSQL 13+
  ‚Ä¢ Conexiones pooling
  ‚Ä¢ Transacciones ACID
  ‚Ä¢ √çndices optimizados
end note

note right of userEntity
  <b>Entidades de Dominio:</b>
  ‚Ä¢ L√≥gica de negocio pura
  ‚Ä¢ Sin dependencias externas
  ‚Ä¢ Validaciones de dominio
  ‚Ä¢ Reglas de negocio
end note

note left of repositories
  <b>Implementaciones:</b>
  ‚Ä¢ UsuarioImplRepository
  ‚Ä¢ LectorImplRepository
  ‚Ä¢ DocumentoImplRepository
  ‚Ä¢ CategoriaImplRepository
  ‚Ä¢ PrestamoImplRepository
end note

@enduml